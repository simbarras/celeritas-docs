%%---------------------------------------------------------------------------%%
% geometry.tex
%%---------------------------------------------------------------------------%%
\section{Geometry and \ac{em} fields}

Accurate simulation of \ac{hep} detector output requires a highly detailed model
of the detector apparatus and nearby components. \ac{mc} transport requires that
the model geometry be well-defined at every point in space, requiring a model
that is ``watertight,'' or heuristics for recovering from inconsistencies (e.g.,
overlapping or missing regions), or both. Since particles undergo collisions and
charged particles constantly change direction as they move through the magnetic
fields in the detector, traditional straight-line ray tracing is necessary but
not sufficient to correctly navigate the geometry.

The \acs{vecgeom} library supports navigation through Geant4-defined detector
geometries in \ac{cpu}-only code and on \cuda-enabled devices
\cite{apostolakis_towards_2015} and is the initial and primary geometry package
in \celeritas. Figure~\ref{fig:vecgeom-cms} is a representation of the \ac{cms}
geometry traced in parallel on \ac{gpu} using the \celeritas particle tracking
interface to \acs{vecgeom}.
%%
\begin{figure}
  \centering%
  \begin{subfigure}{3in}%
    \centering%
    \includegraphics[height=2in]{figs/cms-xz.pdf}%
    \caption{$y=0$}%
  \end{subfigure}%
  \begin{subfigure}{3in}%
    \centering%
    \includegraphics[height=2in]{figs/cms-xy.pdf}%
    \caption{$z=0$}%
  \end{subfigure}
  \caption{On-device \acs{vecgeom} ray traces of the \acs{cms} generated with
the \celeritas ray trace demonstration app.}
\label{fig:vecgeom-cms}
\end{figure}

A new, alternate geometry in \celeritas provides a test bed for experimenting
with platform-portable navigation that uses fundamentally different algorithms
from \acs{vecgeom}. This implementation, \ac{orange}, is an initial \ac{gpu}
port of the new modernized geometry used by the SCALE nuclear engineering code
suite to model complex multi-level nuclear reactor and neutral particle
shielding problems~\cite{scale}. The \celeritas port uses the Collection
paradigm
%
\celcomment{(make sure this definition is explained)}
%
to store quadric surface representations and define cell volumes as \ac{csg}
combinations of those surfaces. At present the \ac{gpu} prototype implementation
supports only a single geometry level, but the extension of this implementation
to the full capabilities available on \ac{cpu} will be relatively
straightforward. We are actively collaborating with the \acs{vecgeom} group at
\acs{cern} to research how \ac{orange} and its methodology could power the next
generation of Geant4 tracking on \ac{gpu}.

\celeritas supports on-device propagation of particles through arbitrary
magnetic fields. Using a \Cpp-based template system for high-performance,
platform-independent extensibility, it allows different integration algorithms
for different user-defined fields.
